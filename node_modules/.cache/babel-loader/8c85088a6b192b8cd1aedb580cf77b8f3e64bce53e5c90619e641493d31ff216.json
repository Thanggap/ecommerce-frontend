{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{Container,Typography,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,Paper,Button,Chip,CircularProgress,Alert,Box}from\"@mui/material\";import{useNavigate}from\"react-router-dom\";import{useAuth}from\"../../context/AuthContext\";import{getAllUsers,promoteUser,demoteUser}from\"../../services/User\";import{getUserId}from\"../../types/AuthTypes\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function AdminDashboard(){const[users,setUsers]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(\"\");const[success,setSuccess]=useState(\"\");const{user,isLoggedIn}=useAuth();const navigate=useNavigate();useEffect(()=>{// Check quyen admin\nif(!isLoggedIn){navigate(\"/login\");return;}if((user===null||user===void 0?void 0:user.role)!==\"admin\"){navigate(\"/\");return;}fetchUsers();},[isLoggedIn,user,navigate]);const fetchUsers=async()=>{try{setLoading(true);const data=await getAllUsers();setUsers(data);}catch(err){var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.detail)||\"Khong the tai danh sach user\");}finally{setLoading(false);}};const handlePromote=async userId=>{try{setError(\"\");setSuccess(\"\");await promoteUser(userId);setSuccess(\"Da nang cap user thanh admin!\");fetchUsers();}catch(err){var _err$response2,_err$response2$data;setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.detail)||\"Khong the nang cap user\");}};const handleDemote=async userId=>{try{setError(\"\");setSuccess(\"\");await demoteUser(userId);setSuccess(\"Da ha cap admin thanh user!\");fetchUsers();}catch(err){var _err$response3,_err$response3$data;setError(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.detail)||\"Khong the ha cap user\");}};if(loading){return/*#__PURE__*/_jsx(Container,{sx:{py:4,textAlign:\"center\"},children:/*#__PURE__*/_jsx(CircularProgress,{})});}return/*#__PURE__*/_jsxs(Container,{sx:{py:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:\"Admin Dashboard - Quan ly User\"}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mb:2},children:error}),success&&/*#__PURE__*/_jsx(Alert,{severity:\"success\",sx:{mb:2},children:success}),/*#__PURE__*/_jsxs(Box,{sx:{mb:3},children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",href:\"/admin/products\",sx:{mr:2},children:\"Quan ly san pham\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",href:\"/admin/add-product\",sx:{mr:2},children:\"Them san pham\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",onClick:fetchUsers,children:\"Lam moi\"})]}),/*#__PURE__*/_jsx(TableContainer,{component:Paper,children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"Email\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Ho ten\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Role\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Trang thai\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Hanh dong\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:users.map(u=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:u.email}),/*#__PURE__*/_jsx(TableCell,{children:u.first_name||u.last_name?\"\".concat(u.first_name||\"\",\" \").concat(u.last_name||\"\").trim():\"-\"}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Chip,{label:u.role,color:u.role===\"admin\"?\"primary\":\"default\",size:\"small\"})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Chip,{label:u.is_active?\"Active\":\"Inactive\",color:u.is_active?\"success\":\"error\",size:\"small\"})}),/*#__PURE__*/_jsx(TableCell,{children:u.role===\"user\"?/*#__PURE__*/_jsx(Button,{variant:\"contained\",size:\"small\",color:\"primary\",onClick:()=>handlePromote(getUserId(u)),children:\"Nang cap Admin\"}):getUserId(u)!==getUserId(user)?/*#__PURE__*/_jsx(Button,{variant:\"outlined\",size:\"small\",color:\"warning\",onClick:()=>handleDemote(getUserId(u)),children:\"Ha cap User\"}):/*#__PURE__*/_jsx(Chip,{label:\"Ban\",size:\"small\"})})]},getUserId(u)))})]})})]});}","map":{"version":3,"names":["React","useState","useEffect","Container","Typography","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","Paper","Button","Chip","CircularProgress","Alert","Box","useNavigate","useAuth","getAllUsers","promoteUser","demoteUser","getUserId","jsx","_jsx","jsxs","_jsxs","AdminDashboard","users","setUsers","loading","setLoading","error","setError","success","setSuccess","user","isLoggedIn","navigate","role","fetchUsers","data","err","_err$response","_err$response$data","response","detail","handlePromote","userId","_err$response2","_err$response2$data","handleDemote","_err$response3","_err$response3$data","sx","py","textAlign","children","variant","gutterBottom","severity","mb","href","mr","onClick","component","map","u","email","first_name","last_name","concat","trim","label","color","size","is_active"],"sources":["/home/thang/Documents/tmdt/ecommerce/frontend/src/pages/admin/AdminDashboard.tsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport {\n  Container,\n  Typography,\n  Table,\n  TableBody,\n  TableCell,\n  TableContainer,\n  TableHead,\n  TableRow,\n  Paper,\n  Button,\n  Chip,\n  CircularProgress,\n  Alert,\n  Box,\n} from \"@mui/material\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useAuth } from \"../../context/AuthContext\";\nimport { getAllUsers, promoteUser, demoteUser } from \"../../services/User\";\nimport { IUser, getUserId } from \"../../types/AuthTypes\";\n\nexport default function AdminDashboard() {\n  const [users, setUsers] = useState<IUser[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(\"\");\n  const [success, setSuccess] = useState(\"\");\n  const { user, isLoggedIn } = useAuth();\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    // Check quyen admin\n    if (!isLoggedIn) {\n      navigate(\"/login\");\n      return;\n    }\n    if (user?.role !== \"admin\") {\n      navigate(\"/\");\n      return;\n    }\n\n    fetchUsers();\n  }, [isLoggedIn, user, navigate]);\n\n  const fetchUsers = async () => {\n    try {\n      setLoading(true);\n      const data = await getAllUsers();\n      setUsers(data);\n    } catch (err: any) {\n      setError(err.response?.data?.detail || \"Khong the tai danh sach user\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handlePromote = async (userId: string) => {\n    try {\n      setError(\"\");\n      setSuccess(\"\");\n      await promoteUser(userId);\n      setSuccess(\"Da nang cap user thanh admin!\");\n      fetchUsers();\n    } catch (err: any) {\n      setError(err.response?.data?.detail || \"Khong the nang cap user\");\n    }\n  };\n\n  const handleDemote = async (userId: string) => {\n    try {\n      setError(\"\");\n      setSuccess(\"\");\n      await demoteUser(userId);\n      setSuccess(\"Da ha cap admin thanh user!\");\n      fetchUsers();\n    } catch (err: any) {\n      setError(err.response?.data?.detail || \"Khong the ha cap user\");\n    }\n  };\n\n  if (loading) {\n    return (\n      <Container sx={{ py: 4, textAlign: \"center\" }}>\n        <CircularProgress />\n      </Container>\n    );\n  }\n\n  return (\n    <Container sx={{ py: 4 }}>\n      <Typography variant=\"h4\" gutterBottom>\n        Admin Dashboard - Quan ly User\n      </Typography>\n\n      {error && (\n        <Alert severity=\"error\" sx={{ mb: 2 }}>\n          {error}\n        </Alert>\n      )}\n      {success && (\n        <Alert severity=\"success\" sx={{ mb: 2 }}>\n          {success}\n        </Alert>\n      )}\n\n      <Box sx={{ mb: 3 }}>\n        <Button variant=\"contained\" href=\"/admin/products\" sx={{ mr: 2 }}>\n          Quan ly san pham\n        </Button>\n        <Button variant=\"contained\" href=\"/admin/add-product\" sx={{ mr: 2 }}>\n          Them san pham\n        </Button>\n        <Button variant=\"outlined\" onClick={fetchUsers}>\n          Lam moi\n        </Button>\n      </Box>\n\n      <TableContainer component={Paper}>\n        <Table>\n          <TableHead>\n            <TableRow>\n              <TableCell>Email</TableCell>\n              <TableCell>Ho ten</TableCell>\n              <TableCell>Role</TableCell>\n              <TableCell>Trang thai</TableCell>\n              <TableCell>Hanh dong</TableCell>\n            </TableRow>\n          </TableHead>\n          <TableBody>\n            {users.map((u) => (\n              <TableRow key={getUserId(u)}>\n                <TableCell>{u.email}</TableCell>\n                <TableCell>\n                  {u.first_name || u.last_name\n                    ? `${u.first_name || \"\"} ${u.last_name || \"\"}`.trim()\n                    : \"-\"}\n                </TableCell>\n                <TableCell>\n                  <Chip\n                    label={u.role}\n                    color={u.role === \"admin\" ? \"primary\" : \"default\"}\n                    size=\"small\"\n                  />\n                </TableCell>\n                <TableCell>\n                  <Chip\n                    label={u.is_active ? \"Active\" : \"Inactive\"}\n                    color={u.is_active ? \"success\" : \"error\"}\n                    size=\"small\"\n                  />\n                </TableCell>\n                <TableCell>\n                  {u.role === \"user\" ? (\n                    <Button\n                      variant=\"contained\"\n                      size=\"small\"\n                      color=\"primary\"\n                      onClick={() => handlePromote(getUserId(u))}\n                    >\n                      Nang cap Admin\n                    </Button>\n                  ) : getUserId(u) !== getUserId(user as IUser) ? (\n                    <Button\n                      variant=\"outlined\"\n                      size=\"small\"\n                      color=\"warning\"\n                      onClick={() => handleDemote(getUserId(u))}\n                    >\n                      Ha cap User\n                    </Button>\n                  ) : (\n                    <Chip label=\"Ban\" size=\"small\" />\n                  )}\n                </TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </TableContainer>\n    </Container>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}